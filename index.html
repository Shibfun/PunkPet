<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PunkPet - Collect</title>
    <link rel="icon" href="images/1.png" type="image/png">
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #FF9100;
            --secondary-color: #FFFFFF;
            --background-color: #1C2526;
            --card-bg: #2D383A;
            --text-color: #FF9100;
            --header-text-color: #FFFFFF;
            --border-radius: 10px;
            --pixel-border: 2px solid #FF9100;
            --shadow: 0 4px 12px rgba(255, 145, 0, 0.4);
            --transition-speed: 0.3s;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Comic Neue', cursive; }
        body { background: var(--background-color); color: var(--text-color); padding: 15px; min-height: 100vh; display: flex; justify-content: center; align-items: flex-start; }
        .container { width: 100%; max-width: 1200px; background: var(--card-bg); border: var(--pixel-border); border-radius: var(--border-radius); padding: 20px; box-shadow: var(--shadow); overflow: hidden; }
        .header { background: var(--primary-color); padding: 15px; border: var(--pixel-border); border-radius: var(--border-radius); text-align: center; font-size: 24px; margin-bottom: 15px; color: var(--header-text-color); box-shadow: var(--shadow); display: flex; justify-content: center; align-items: center; }
        .header img { width: 40px; height: 40px; margin-right: 10px; image-rendering: pixelated; }
        .connect-section { display: flex; justify-content: center; margin-bottom: 15px; }
        .connect-section button { padding: 10px 20px; background: var(--primary-color); color: var(--secondary-color); border: var(--pixel-border); border-radius: var(--border-radius); cursor: pointer; font-size: 14px; transition: transform var(--transition-speed), background var(--transition-speed); box-shadow: var(--shadow); max-width: 180px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .connect-section button:hover { background: #E67E00; transform: translateY(-2px); }
        .connect-section button:disabled { background: #555555; cursor: not-allowed; transform: none; }
        .filter-section { display: flex; justify-content: center; margin-bottom: 15px; gap: 10px; animation: fadeIn var(--transition-speed) ease-in; }
        .filter-section button { padding: 8px 15px; background: var(--primary-color); color: var(--secondary-color); border: var(--pixel-border); border-radius: var(--border-radius); cursor: pointer; font-size: 12px; transition: transform var(--transition-speed), background var(--transition-speed); box-shadow: var(--shadow); }
        .filter-section button:hover { background: #E67E00; transform: translateY(-2px); }
        .filter-section button.active { background: #555555; transform: none; }
        .pets-section { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; margin-top: 15px; opacity: 0; animation: fadeIn var(--transition-speed) ease-in; }
        .pet-card { background: var(--card-bg); border: var(--pixel-border); border-radius: var(--border-radius); text-align: center; padding: 12px; box-shadow: var(--shadow); transition: transform var(--transition-speed), opacity var(--transition-speed); position: relative; overflow: hidden; }
        .pet-card:hover { transform: translateY(-3px); }
        .pet-card img { width: 48px; height: 48px; margin: 0 auto 10px; border: 2px solid #FF9100; border-radius: 5px; image-rendering: pixelated; }
        .pet-card .pet-id, .pet-card .pet-info { font-size: 12px; margin-bottom: 6px; color: var(--text-color); }
        .pet-card .progress-bar { width: 100%; height: 4px; background: #444; margin-top: 5px; border-radius: 2px; overflow: hidden; }
        .pet-card .progress { height: 100%; background: var(--primary-color); transition: width var(--transition-speed); }
        .pet-card button { padding: 6px; background: var(--primary-color); color: var(--secondary-color); border: var(--pixel-border); border-radius: var(--border-radius); cursor: pointer; font-size: 10px; width: 100%; margin: 4px 0; transition: transform var(--transition-speed), background var(--transition-speed); box-shadow: var(--shadow); }
        .pet-card button:hover:not(:disabled) { background: #E67E00; transform: translateY(-2px); }
        .pet-card button:disabled { background: #555555; cursor: not-allowed; transform: none; }
        .dog-section { text-align: center; margin-top: 20px; }
        .dog-section img { width: 60px; height: 60px; margin-bottom: 10px; border: 2px solid #FF9100; border-radius: 8px; image-rendering: pixelated; }
        .dog-message { font-size: 14px; color: var(--primary-color); font-style: italic; transition: opacity var(--transition-speed); }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @media (max-width: 480px) { body { padding: 8px; } .container { padding: 10px; } .header { font-size: 18px; } .header img { width: 30px; height: 30px; } .pets-section { grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 8px; } .pet-card img { width: 36px; height: 36px; } .pet-card .pet-id, .pet-card .pet-info { font-size: 10px; } .pet-card button { font-size: 9px; padding: 5px; } .dog-section img { width: 40px; height: 40px; } .connect-section { flex-direction: column; } .filter-section { flex-direction: column; gap: 5px; } .connect-section button { font-size: 12px; padding: 8px; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header"><img src="images/1.png" alt="PunkPet Logo">PunkPet</div>
        <div class="connect-section">
            <button id="connectWalletButton">Connect Wallet</button>
        </div>
        <div class="filter-section">
            <button id="filterAll" class="active">All</button>
            <button id="filterMy">My</button>
        </div>
        <div class="pets-section" id="petsSection"></div>
        <div class="dog-section">
            <img src="images/1.png" alt="Shiba Dog">
            <div class="dog-message" id="dogMessage">"Hey punk, connect your wallet to dive in!"</div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.7.0/dist/web3.min.js"></script>
    <script>
        const petPrices = {
            1: "0", 2: "1000000", 3: "2000000", 4: "3000000", 5: "4000000", 6: "5000000",
            7: "6000000", 8: "7000000", 9: "8000000", 10: "9000000", 11: "10000000", 12: "11000000",
            13: "12000000", 14: "13000000", 15: "14000000", 16: "15000000", 17: "16000000", 18: "50000000",
            19: "60000000", 20: "70000000", 21: "80000000", 22: "90000000", 23: "100000000", 24: "110000000",
            25: "120000000", 26: "130000000", 27: "140000000", 28: "150000000", 29: "160000000", 30: "170000000",
            31: "180000000", 32: "190000000", 33: "200000000", 34: "210000000", 35: "220000000", 36: "230000000",
            37: "240000000", 38: "250000000", 39: "500000000", 40: "600000000", 41: "700000000", 42: "800000000",
            43: "900000000", 44: "1000000000", 45: "1100000000", 46: "1200000000", 47: "1300000000", 48: "1400000000",
            49: "1500000000", 50: "1600000000", 51: "1700000000", 52: "1800000000", 53: "1900000000", 54: "2000000000",
            55: "5000000000", 56: "6000000000", 57: "7000000000", 58: "8000000000", 59: "9000000000", 60: "10000000000",
            61: "11000000000", 62: "12000000000", 63: "13000000000", 64: "14000000000", 65: "15000000000", 66: "16000000000",
            67: "17000000000", 68: "18000000000", 69: "19000000000", 70: "20000000000", 71: "23000000000", 72: "100000000000",
            73: "100000000000", 74: "100000000000", 75: "100000000000", 76: "100000000000", 77: "100000000000"
        };

        const contractAddress = "0xF6a3f91D09Ef0Cf15fF8714724eF6AD46195148D";
        const contractAbi = [
            {"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[{"internalType":"uint256","name":"petType","type":"uint256"}],"name":"purchasePet","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[{"internalType":"uint256","name":"petId","type":"uint256"}],"name":"feedPet","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"petType","type":"uint256"}],"name":"giftPet","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[],"name":"withdrawNONE","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[],"name":"withdrawFEED","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getUserPets","outputs":[{"internalType":"uint256[]","name":"petIds","type":"uint256[]"},{"internalType":"uint256[]","name":"petTypes","type":"uint256[]"},{"internalType":"uint256[]","name":"nextFeedTimes","type":"uint256[]"},{"internalType":"uint256[]","name":"feedCounts","type":"uint256[]"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getUserTotalPets","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"uint256","name":"petType","type":"uint256"}],"name":"getPetPrice","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"getFeedCost","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"pure","type":"function"},
            {"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getUserNONEBalance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getUserNONEAllowance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"buyer","type":"address"},{"indexed":false,"internalType":"uint256","name":"petType","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"price","type":"uint256"},{"indexed":false,"internalType":"bool","name":"success","type":"bool"},{"indexed":false,"internalType":"string","name":"reason","type":"string"}],"name":"PurchaseAttempt","type":"event"}
        ];
        const erc20Abi = [
            {"constant":true,"inputs":[{"name":"_owner","type":"address"}],"name":"balanceOf","outputs":[{"name":"balance","type":"uint256"}],"type":"function"},
            {"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_value","type":"uint256"}],"name":"approve","outputs":[{"name":"success","type":"bool"}],"type":"function"},
            {"constant":true,"inputs":[{"name":"_owner","type":"address"},{"name":"_spender","type":"address"}],"name":"allowance","outputs":[{"name":"remaining","type":"uint256"}],"type":"function"}
        ];
        const NONE_TOKEN_ADDRESS = "0x64E19b6a167878d2483d166212A3c2c68b1eB842";
        const shibarium = { chainId: 109, chainName: 'Shibarium', nativeCurrency: { name: 'BONE', symbol: 'BONE', decimals: 18 }, rpcUrls: ['https://rpc.shibrpc.com'], blockExplorerUrls: ['https://shibariumscan.io'] };
        let web3, account, contract;
        let filterMode = 'all';

        const dogMessages = {
            connectStart: ["Yo punk, jacking into your wallet, hold tight!","Scanning the blockchain for your creds, stay sharp!","Plugging into Shibarium, let’s roll, rebel!","Hacking your wallet vibes, keep it real!"],
            connectSuccess: ["Hell yeah, you’re in, punk master!","Wallet’s live, time to dominate, rebel!","Shibarium’s ours, let’s punk it up!","Connected, punk legend, let’s cause chaos!"],
            connectFail: ["Damn, wallet slipped, try again, punk!","No creds detected, get back in the game!","Glitch in the system, retry, rebel!","Wallet’s ghosting us, dig it out!","No wallet detected. Install MetaMask.","No accounts found. Unlock your wallet."],
            purchaseStart: ["Snatching pets, hold on, punk!","Grabbing those pixels, stay cool, rebel!","Collecting chaos, let’s punk it!","Buying spree, punk style, hang tight!"],
            purchaseSuccess: ["Pets secured, you’re a punk legend!","Pixels owned, total rebel victory!","You’ve claimed ‘em, punk king!","Purchase complete, chaos unleashed!"],
            purchaseFail: ["Buy failed, punk, retry!","No NONE, hit the grind again!","Chain glitched, punk it up again!","Purchase crashed, fight harder!"],
            feedStart: ["Feeding frenzy, hold on, punk!","Nourishing pixels, stay sharp, rebel!","Feeding time, punk chaos incoming!","Powering up pets, punk style!"],
            feedSuccess: ["Pets fed, you’re a punk pro!","Pixels powered, rebel win!","Feeding done, punk hero status!","Pets thriving, punk domination!"],
            feedFail: ["Feeding crashed, retry, punk!","No FEED, hit the grind, rebel!","Feed glitched, punk it up!","Feeding failed, dig deeper!"],
            insufficientBalance: ["NONE’s low, punk, stack more!","Need more NONE, rebel, hustle!","Wallet’s dry, punk, earn some!","NONE’s gone, get back in the game!"],
            insufficientFeed: ["FEED’s low, punk, stock up!","Need more FEED, rebel, grind!","FEED’s out, punk, refill!","FEED’s gone, hit the streets!"]
        };

        function getRandomMessage(type) { return dogMessages[type][Math.floor(Math.random() * dogMessages[type].length)]; }

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('connectWalletButton').addEventListener('click', connectWallet);
            document.getElementById('filterAll').addEventListener('click', () => setFilter('all'));
            document.getElementById('filterMy').addEventListener('click', () => setFilter('my'));
            setupWalletListeners();
            initializePets();
        });

        async function connectWallet() {
            const connectButton = document.getElementById('connectWalletButton');
            const dogMessage = document.getElementById('dogMessage');
            try {
                if (!window.ethereum) throw new Error("No wallet detected. Install MetaMask.");
                connectButton.disabled = true;
                dogMessage.innerText = getRandomMessage('connectStart');
                web3 = new Web3(window.ethereum);
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                if (!accounts.length) throw new Error("No accounts found. Unlock your wallet.");
                account = accounts[0];
                await switchToShibarium();
                contract = new web3.eth.Contract(contractAbi, contractAddress);
                connectButton.textContent = `Connected: ${account.slice(0, 6)}...${account.slice(-4)}`;
                dogMessage.innerText = getRandomMessage('connectSuccess');
                updatePets();
            } catch (error) {
                dogMessage.innerText = getRandomMessage('connectFail') + (error.message ? " " + error.message : "");
                connectButton.textContent = "Connect Wallet";
            } finally { connectButton.disabled = false; }
        }

        async function switchToShibarium() {
            const chainId = await web3.eth.getChainId();
            if (Number(chainId) !== 109) {
                try {
                    await window.ethereum.request({ method: 'wallet_switchEthereumChain', params: [{ chainId: "0x6d" }] });
                } catch (switchError) {
                    if (switchError.code === 4902) {
                        await window.ethereum.request({ method: 'wallet_addEthereumChain', params: [shibarium] });
                    } else { throw switchError; }
                }
            }
        }

        function setupWalletListeners() {
            if (!window.ethereum) return;
            window.ethereum.on('accountsChanged', async (newAccounts) => {
                if (newAccounts.length) {
                    account = newAccounts[0];
                    if (web3) {
                        await switchToShibarium();
                        contract = new web3.eth.Contract(contractAbi, contractAddress);
                        document.getElementById('connectWalletButton').textContent = `Connected: ${account.slice(0, 6)}...${account.slice(-4)}`;
                        updatePets();
                    } else { await connectWallet(); }
                } else {
                    web3 = null; account = null; contract = null;
                    document.getElementById('connectWalletButton').textContent = "Connect Wallet";
                    document.getElementById('dogMessage').innerText = getRandomMessage('connectFail');
                }
            });
            window.ethereum.on('chainChanged', async (chainId) => {
                if (parseInt(chainId, 16) !== 109) {
                    web3 = null; account = null; contract = null;
                    document.getElementById('connectWalletButton').textContent = "Connect Wallet";
                    document.getElementById('dogMessage').innerText = "Wrong chain, punk! Switch to Shibarium!";
                } else if (account) { await connectWallet(); }
            });
        }

        function initializePets() {
            const petsSection = document.getElementById('petsSection');
            for (let i = 1; i <= 77; i++) {
                const petCard = document.createElement('div');
                petCard.className = 'pet-card';
                petCard.id = `pet-type-${i}`;
                const imgSrc = `images/${i}.png`;
                petCard.innerHTML = `<img src="${imgSrc}" alt="Pet Type #${i}" onerror="this.src='images/1.png';"><div class="pet-id">Pet Type #${i}</div><div class="pet-info">Price: ${petPrices[i]} NONE</div>`;
                const buyButton = document.createElement('button');
                buyButton.id = `buyButton-${i}`;
                buyButton.textContent = 'Buy';
                buyButton.disabled = !web3 || !account;
                buyButton.onclick = () => initiatePurchase(i);
                petCard.appendChild(buyButton);
                petsSection.appendChild(petCard);
            }
            petsSection.style.opacity = 1;
        }

        async function updatePets() {
            const petsSection = document.getElementById('petsSection');
            petsSection.innerHTML = '';

            if (filterMode === 'all') {
                for (let i = 1; i <= 77; i++) {
                    const petCard = document.createElement('div');
                    petCard.className = 'pet-card';
                    petCard.id = `pet-type-${i}`;
                    const imgSrc = `images/${i}.png`;
                    petCard.innerHTML = `<img src="${imgSrc}" alt="Pet Type #${i}" onerror="this.src='images/1.png';"><div class="pet-id">Pet Type #${i}</div><div class="pet-info">Price: ${petPrices[i]} NONE</div>`;
                    const buyButton = document.createElement('button');
                    buyButton.id = `buyButton-${i}`;
                    buyButton.textContent = 'Buy';
                    buyButton.disabled = !web3 || !account || (i > 1 && !await hasSufficientNONE(petPrices[i]));
                    buyButton.onclick = () => initiatePurchase(i);
                    petCard.appendChild(buyButton);
                    petsSection.appendChild(petCard);
                }
            } else {
                if (!web3 || !account || !contract) {
                    const emptyMessage = document.createElement('div');
                    emptyMessage.className = 'pet-info';
                    emptyMessage.style.textAlign = 'center';
                    emptyMessage.style.width = '100%';
                    emptyMessage.innerText = 'Connect wallet to view your pets.';
                    petsSection.appendChild(emptyMessage);
                    return;
                }

                let userPets = { petIds: [], petTypes: [], nextFeedTimes: [], feedCounts: [] };
                [userPets.petIds, userPets.petTypes, userPets.nextFeedTimes, userPets.feedCounts] = await contract.methods.getUserPets(account).call();
                console.log("User Pets Data:", userPets);

                if (!userPets.petIds.length) {
                    const emptyMessage = document.createElement('div');
                    emptyMessage.className = 'pet-info';
                    emptyMessage.style.textAlign = 'center';
                    emptyMessage.style.width = '100%';
                    emptyMessage.innerText = 'No pets owned yet.';
                    petsSection.appendChild(emptyMessage);
                    return;
                }

                userPets.petIds.forEach((petId, index) => {
                    const petType = userPets.petTypes[index];
                    const petCard = document.createElement('div');
                    petCard.className = 'pet-card';
                    petCard.id = `pet-${petId}`;
                    const canFeed = new Date().getTime() / 1000 >= Number(userPets.nextFeedTimes[index]);
                    const nextFeedTime = Number(userPets.nextFeedTimes[index]);
                    const timeUntilNextFeed = canFeed || nextFeedTime === 0 ? 0 : (nextFeedTime - Math.floor(Date.now() / 1000)) / (20 * 3600) * 100;
                    const imgSrc = `images/${petType}.png`;
                    petCard.innerHTML = `<img src="${imgSrc}" alt="Pet #${petId}" onerror="this.src='images/1.png';"><div class="pet-id">Pet ID #${petId} (Type ${petType})</div><div class="pet-info">Next Feed: ${canFeed ? 'Now' : formatTimeUntil(nextFeedTime)}</div><div class="pet-info">Fed: ${userPets.feedCounts[index]} times</div><div class="progress-bar"><div class="progress" style="width: ${timeUntilNextFeed > 0 ? Math.min(100, timeUntilNextFeed) : 0}%;"></div></div>`;
                    const feedButton = document.createElement('button');
                    feedButton.id = `feedPet-${petId}`;
                    feedButton.textContent = 'Feed';
                    feedButton.onclick = () => feedPet(petId);
                    feedButton.disabled = !canFeed;
                    petCard.appendChild(feedButton);
                    petsSection.appendChild(petCard);
                });
            }
            petsSection.style.opacity = 1;
        }

        async function hasSufficientNONE(priceStr) {
            if (!web3 || !account) return false;
            const noneContract = new web3.eth.Contract(erc20Abi, NONE_TOKEN_ADDRESS);
            const balance = await noneContract.methods.balanceOf(account).call();
            const priceWei = web3.utils.toWei(priceStr, 'ether');
            console.log(`Balance: ${web3.utils.fromWei(balance, 'ether')} NONE, Required: ${web3.utils.fromWei(priceWei, 'ether')} NONE`);
            return web3.utils.toBN(balance).gte(web3.utils.toBN(priceWei));
        }

        function setFilter(mode) {
            filterMode = mode;
            document.getElementById('filterAll').className = mode === 'all' ? 'active' : '';
            document.getElementById('filterMy').className = mode === 'my' ? 'active' : '';
            updatePets();
        }

        function formatTimeUntil(nextFeedTime) {
            const now = Math.floor(Date.now() / 1000);
            const secondsUntil = nextFeedTime - now;
            if (secondsUntil <= 0) return "Now";
            const hours = Math.floor(secondsUntil / 3600);
            const minutes = Math.floor((secondsUntil % 3600) / 60);
            const seconds = secondsUntil % 60;
            return `${hours}h ${minutes}m ${seconds}s`;
        }

        async function initiatePurchase(petType) {
            const buyButton = document.getElementById(`buyButton-${petType}`);
            const dogMessage = document.getElementById('dogMessage');
            if (!web3 || !account) { dogMessage.innerText = getRandomMessage('connectFail'); return; }

            const price = web3.utils.toWei(petPrices[petType].toString(), 'ether');
            const noneContract = new web3.eth.Contract(erc20Abi, NONE_TOKEN_ADDRESS);

            buyButton.disabled = true;
            buyButton.textContent = 'Checking...';
            try {
                const balance = await contract.methods.getUserNONEBalance(account).call();
                console.log(`Balance check: ${web3.utils.fromWei(balance, 'ether')} NONE, Required: ${web3.utils.fromWei(price, 'ether')} NONE`);
                if (web3.utils.toBN(balance).lt(web3.utils.toBN(price))) {
                    dogMessage.innerText = getRandomMessage('insufficientBalance');
                    buyButton.textContent = 'Buy';
                    buyButton.disabled = false;
                    return;
                }

                const allowance = await contract.methods.getUserNONEAllowance(account).call();
                console.log(`Allowance check: ${web3.utils.fromWei(allowance, 'ether')} NONE, Required: ${web3.utils.fromWei(price, 'ether')} NONE`);
                if (web3.utils.toBN(allowance).lt(web3.utils.toBN(price))) {
                    buyButton.textContent = 'Authorizing...';
                    await noneContract.methods.approve(contractAddress, price).send({ from: account });
                    dogMessage.innerText = "Authorization complete!";
                }

                buyButton.textContent = 'Purchasing...';
                const tx = await contract.methods.purchasePet(petType).send({ from: account });
                console.log("Purchase TX:", tx.transactionHash);
                dogMessage.innerText = getRandomMessage('purchaseSuccess');
                updatePets();
            } catch (error) {
                console.error("Purchase error:", error);
                dogMessage.innerText = getRandomMessage('purchaseFail') + (error.message ? " " + error.message : "");
                buyButton.textContent = 'Buy';
            } finally {
                buyButton.disabled = false;
            }
        }

        async function feedPet(petId) {
            const feedButton = document.getElementById(`feedPet-${petId}`);
            const dogMessage = document.getElementById('dogMessage');
            if (!web3 || !account) { dogMessage.innerText = getRandomMessage('connectFail'); return; }

            feedButton.disabled = true;
            dogMessage.innerText = getRandomMessage('feedStart');
            try {
                await contract.methods.feedPet(petId).send({ from: account });
                dogMessage.innerText = getRandomMessage('feedSuccess');
                updatePets();
            } catch (error) {
                console.error("Feed error:", error);
                dogMessage.innerText = getRandomMessage('feedFail') + (error.message ? " " + error.message : "");
            } finally {
                feedButton.disabled = false;
            }
        }
    </script>
</body>
</html>
